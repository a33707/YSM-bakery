<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”°ë‹˜ì„ ìœ„í•œ ì¼€ì´í¬ ë§ˆìŠ¤í„°</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #fff0f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-bottom: 80px;
            overflow-y: auto; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ í—ˆìš© */
        }
        header { width: 100%; padding: 15px; background: white; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .level-badge { background: #ff69b4; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .exp-bar { width: 120px; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; }
        #exp-fill { width: 0%; height: 100%; background: #ff69b4; transition: width 0.3s; }
        #cake-base {
            width: 280px; height: 200px; background: #ffffff; border-radius: 30px;
            position: relative; box-shadow: 0 15px 0 #f0f0f0; margin: 30px;
            overflow: hidden; touch-action: none; /* ì¼€ì´í¬ ìœ„ì—ì„œë§Œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        .topping-bar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; padding: 10px; max-width: 95%; background: white; border-radius: 20px; }
        .topping-item { font-size: 30px; cursor: pointer; padding: 5px; border: 3px solid transparent; border-radius: 12px; }
        .topping-item.selected { border-color: #ff69b4; background: #ffe4e1; }
        .placed-topping { position: absolute; font-size: 35px; pointer-events: none; transform: translate(-50%, -50%); animation: pop 0.3s ease-out; z-index: 2; }
        .placed-jam { position: absolute; width: 40px; height: 40px; border-radius: 50%; pointer-events: none; filter: blur(5px); opacity: 0.7; transform: translate(-50%, -50%); z-index: 1; }
        @keyframes pop { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
        .stage { display: none; flex-direction: column; align-items: center; width: 100%; }
        .stage.active { display: flex; }
        button { margin-top: 20px; padding: 15px 30px; font-size: 18px; border: none; border-radius: 30px; background: #ff69b4; color: white; font-weight: bold; }
        .home-btn { background: #999; margin-left: 10px; }
    </style>
</head>
<body>
    <header>
        <div><span id="rank-text">ğŸ£ ì´ˆë³´ ìš”ë¦¬ì‚¬</span><div class="exp-bar"><div id="exp-fill"></div></div></div>
        <div class="level-badge">LV.<span id="level-num">1</span></div>
    </header>
    <div id="stage1" class="stage active">
        <div id="cake-base"></div>
        <div class="topping-bar">
            <div class="topping-item selected" onclick="selectTopping(this, 'ğŸ“', 'emoji')">ğŸ“</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ«', 'emoji')">ğŸ«</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ«', 'emoji')">ğŸ«</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸŠ', 'emoji')">ğŸŠ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¬', 'emoji')">ğŸ¬</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ’–', 'emoji')">ğŸ’–</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸŒŸ', 'emoji')">ğŸŒŸ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ•¯ï¸', 'emoji')">ğŸ•¯ï¸</div>
            <div class="topping-item" onclick="selectTopping(this, '#ff69b4', 'jam')">ğŸ’‰ğŸ’–</div>
            <div class="topping-item" onclick="selectTopping(this, '#ffd700', 'jam')">ğŸ’‰ğŸ¯</div>
            <div class="topping-item" onclick="selectTopping(this, '#4b0082', 'jam')">ğŸ’‰ğŸ‡</div>
            <div class="topping-item" onclick="selectTopping(this, '#00fa9a', 'jam')">ğŸ’‰ğŸƒ</div>
        </div>
        <div style="display:flex;"><button onclick="goStage2()">ë°°ë‹¬ ì‹œì‘! ğŸ›µ</button><button onclick="location.href='index.html'" class="home-btn">ğŸ  í™ˆ</button></div>
    </div>
    <div id="stage2" class="stage">
        <h2 id="delivery-status">ğŸ›µ ë°°ë‹¬ ì¤‘...</h2>
        <div style="font-size: 40px; width: 80%; position: relative; height: 60px;">
            <span id="scooter" style="position:absolute; left:0; transition:3s linear;">ğŸ›µğŸ“¦</span>
            <span style="float:right;">ğŸ </span>
        </div>
        <button id="next-btn" onclick="nextLevel()" style="display:none;">ë‹¤ì‹œ ë§Œë“¤ê¸°</button>
    </div>
    <script>
        let selectedTopping = 'ğŸ“'; let selectedType = 'emoji'; let exp = 0; let level = 1;
        let isDrawing = false; let lastDrawTime = 0;
        const cakeBase = document.getElementById('cake-base');
        const ranks = ["ğŸ£ ì´ˆë³´ ìš”ë¦¬ì‚¬", "ğŸ¥ ê²¬ìŠµ ì…°í”„", "ğŸ‘¨â€ğŸ³ ì „ë¬¸ ìš”ë¦¬ì‚¬", "ğŸ‘‘ ì¼€ì´í¬ ë§ˆìŠ¤í„°"];

        function selectTopping(el, val, type) {
            document.querySelectorAll('.topping-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected'); selectedTopping = val; selectedType = type;
        }

        function placeTopping(e) {
            const rect = cakeBase.getBoundingClientRect();
            const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            const x = clientX - rect.left; const y = clientY - rect.top;
            if(x < 0 || x > rect.width || y < 0 || y > rect.height) return;

            const item = document.createElement('div');
            if (selectedType === 'emoji') {
                item.className = 'placed-topping'; item.innerText = selectedTopping;
                item.style.transform = `translate(-50%, -50%) rotate(${Math.random()*40-20}deg)`;
            } else {
                item.className = 'placed-jam'; item.style.backgroundColor = selectedTopping;
            }
            item.style.left = x + 'px'; item.style.top = y + 'px';
            cakeBase.appendChild(item); updateExp(1);
        }

        const handleStart = (e) => { isDrawing = true; placeTopping(e); };
        const handleMove = (e) => {
            if (!isDrawing) return;
            const now = Date.now();
            if (now - lastDrawTime > 150) { placeTopping(e); lastDrawTime = now; }
        };
        cakeBase.addEventListener('mousedown', handleStart);
        window.addEventListener('mouseup', () => isDrawing = false);
        cakeBase.addEventListener('mousemove', handleMove);
        cakeBase.addEventListener('touchstart', (e) => { isDrawing = true; placeTopping(e.touches[0]); });
        cakeBase.addEventListener('touchend', () => isDrawing = false);
        cakeBase.addEventListener('touchmove', (e) => { if(isDrawing) e.preventDefault(); handleMove(e.touches[0]); }, { passive: false });

        function updateExp(amount) {
            exp += amount; if (exp >= 100) { exp = 0; level++; document.getElementById('level-num').innerText = level; }
            document.getElementById('exp-fill').style.width = exp + "%";
        }
        function goStage2() {
            document.getElementById('stage1').classList.remove('active'); document.getElementById('stage2').classList.add('active');
            const scooter = document.getElementById('scooter');
            setTimeout(() => { scooter.style.left = "calc(100% - 60px)"; }, 100);
            setTimeout(() => { document.getElementById('delivery-status').innerText = "âœ… ë°°ë‹¬ ì™„ë£Œ!"; document.getElementById('next-btn').style.display = 'block'; }, 3200);
        }
        function nextLevel() { location.reload(); }
    </script>
</body>
</html>