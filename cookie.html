<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”°ë‹˜ì„ ìœ„í•œ ì¿ í‚¤ ë§ˆìŠ¤í„°</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #fffaf0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-bottom: 80px;
            overflow-y: auto;
        }
        header { width: 100%; padding: 15px; background: white; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .level-badge { background: #ffc0cb; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .exp-bar { width: 120px; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; }
        #exp-fill { width: 0%; height: 100%; background: #ffc0cb; transition: width 0.3s; }
        #cookie-base {
            width: 250px; height: 250px; background: #f3d5b5; border-radius: 50%;
            position: relative; box-shadow: 0 8px 0 #d2b48c; margin: 20px;
            overflow: hidden; touch-action: none;
        }
        .topping-bar { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; padding: 10px; background: white; border-radius: 25px; max-width: 95%; }
        .topping-item { font-size: 26px; cursor: pointer; padding: 5px; border: 3px solid transparent; border-radius: 12px; }
        .topping-item.selected { border-color: #ffc0cb; background: #ffe4e1; }
        .placed-topping { position: absolute; font-size: 30px; pointer-events: none; transform: translate(-50%, -50%); animation: pop 0.3s ease-out; z-index: 2; }
        .placed-jam { position: absolute; width: 35px; height: 35px; border-radius: 50%; pointer-events: none; filter: blur(4px); opacity: 0.7; transform: translate(-50%, -50%); z-index: 1; }
        @keyframes pop { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
        .stage { display: none; flex-direction: column; align-items: center; width: 100%; }
        .stage.active { display: flex; }
        button { margin-top: 20px; padding: 12px 30px; font-size: 18px; border: none; border-radius: 25px; background: #ffc0cb; color: white; font-weight: bold; }
        .home-btn { background: #ccc; margin-left: 10px; }
    </style>
</head>
<body>
    <header>
        <div><span id="rank-text">ğŸª ì¿ í‚¤ ì´ˆë³´</span><div class="exp-bar"><div id="exp-fill"></div></div></div>
        <div class="level-badge">LV.<span id="level-num">1</span></div>
    </header>
    <div id="stage1" class="stage active">
        <div id="cookie-base"></div>
        <div class="topping-bar">
            <div class="topping-item selected" onclick="selectTopping(this, 'ğŸ«', 'emoji')">ğŸ«</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¥¨', 'emoji')">ğŸ¥¨</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¥œ', 'emoji')">ğŸ¥œ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ’', 'emoji')">ğŸ’</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ’–', 'emoji')">ğŸ’–</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸŒŸ', 'emoji')">ğŸŒŸ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸŒˆ', 'emoji')">ğŸŒˆ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¬', 'emoji')">ğŸ¬</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸª', 'emoji')">ğŸª</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¨', 'emoji')">ğŸ¨</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ', 'emoji')">ğŸ</div>
            <div class="topping-item" onclick="selectTopping(this, 'ğŸ¥›', 'emoji')">ğŸ¥›</div>
            <div class="topping-item" onclick="selectTopping(this, '#ff0000', 'jam')">ğŸ’‰ğŸ“</div>
            <div class="topping-item" onclick="selectTopping(this, '#ffd700', 'jam')">ğŸ’‰ğŸ¯</div>
            <div class="topping-item" onclick="selectTopping(this, '#4682b4', 'jam')">ğŸ’‰ğŸ«</div>
            <div class="topping-item" onclick="selectTopping(this, '#ffffff', 'jam')">ğŸ’‰ğŸ¤</div>
        </div>
        <div style="display:flex;"><button onclick="bakeAndDeliver()">ë°°ë‹¬ ì‹œì‘! ğŸ”¥</button><button onclick="location.href='index.html'" class="home-btn">ğŸ  í™ˆ</button></div>
    </div>
    <div id="stage2" class="stage">
        <h2 id="delivery-status">ğŸ›µ ë°°ë‹¬ ì¤‘...</h2>
        <div style="font-size: 40px; width: 80%; position: relative; height: 50px;">
            <span id="scooter" style="position:absolute; left:0; transition:3s linear;">ğŸ›µğŸ“¦</span>
            <span style="float:right;">ğŸ¡</span>
        </div>
        <button id="next-btn" onclick="nextCookie()">ë‹¤ì‹œ ë§Œë“¤ê¸°</button>
    </div>
    <script>
        let selectedTopping = 'ğŸ«'; let selectedType = 'emoji'; let exp = 0; let level = 1;
        let isDrawing = false; let lastDrawTime = 0;
        const cookieBase = document.getElementById('cookie-base');

        function selectTopping(el, val, type) {
            document.querySelectorAll('.topping-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected'); selectedTopping = val; selectedType = type;
        }

        function placeTopping(e) {
            const rect = cookieBase.getBoundingClientRect();
            const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            const x = clientX - rect.left; const y = clientY - rect.top;
            if(x < 0 || x > rect.width || y < 0 || y > rect.height) return;

            const item = document.createElement('div');
            if (selectedType === 'emoji') {
                item.className = 'placed-topping'; item.innerText = selectedTopping;
            } else {
                item.className = 'placed-jam'; item.style.backgroundColor = selectedTopping;
            }
            item.style.left = x + 'px'; item.style.top = y + 'px';
            cookieBase.appendChild(item); updateExp(1);
        }

        const handleStart = (e) => { isDrawing = true; placeTopping(e); };
        const handleMove = (e) => {
            if (!isDrawing) return;
            const now = Date.now();
            if (now - lastDrawTime > 150) { placeTopping(e); lastDrawTime = now; }
        };
        cookieBase.addEventListener('mousedown', handleStart);
        window.addEventListener('mouseup', () => isDrawing = false);
        cookieBase.addEventListener('mousemove', handleMove);
        cookieBase.addEventListener('touchstart', (e) => { isDrawing = true; placeTopping(e.touches[0]); });
        cookieBase.addEventListener('touchend', () => isDrawing = false);
        cookieBase.addEventListener('touchmove', (e) => { if(isDrawing) e.preventDefault(); handleMove(e.touches[0]); }, { passive: false });

        function updateExp(amount) {
            exp += amount; if (exp >= 100) { exp = 0; level++; document.getElementById('level-num').innerText = level; }
            document.getElementById('exp-fill').style.width = exp + "%";
        }
        function bakeAndDeliver() {
            cookieBase.style.backgroundColor = '#c68642';
            document.getElementById('stage1').classList.remove('active'); document.getElementById('stage2').classList.add('active');
            const scooter = document.getElementById('scooter');
            setTimeout(() => { scooter.style.left = "calc(100% - 60px)"; }, 100);
            setTimeout(() => { document.getElementById('delivery-status').innerText = "âœ… ë°°ë‹¬ ì™„ë£Œ!"; document.getElementById('next-btn').style.display = 'block'; }, 3200);
        }
        function nextCookie() { location.reload(); }
    </script>
</body>
</html>